const ICON_SNOWFLAKE = `<svg
  xmlns="http://www.w3.org/2000/svg"
  width="20"
  height="20"
  viewBox="0 0 128 128"
>
  <defs>
    <linearGradient
      id="linear-gradient"
      x1="0.19582"
      x2="0.90472"
      y1="0.93246"
      y2="-0.08025"
    >
      <stop offset="0" stop-color="#41dfd0" />
      <stop offset="1" stop-color="#ee83ef" />
    </linearGradient>
  </defs>
  <g class="layer">
    <g id="gradient">
      <path
        d="M122.427,82.2l-14.592,2.49L90.983,74.96,115.846,64,90.988,53.037l16.847-9.726,14.592,2.49,1.345-7.885L112.51,35.993l3.966-10.716-7.5-2.777-5.14,13.883L86.989,46.109,89.926,19.1,68,35.152v-16.9L77.453,6.855,71.3,1.747,64,10.541,56.7,1.747,50.547,6.855,60,18.248v16.9L38.084,19.1l2.938,27.014L24.165,36.383,19.026,22.5l-7.5,2.777L15.49,35.993,4.227,37.916,5.573,45.8l14.592-2.49,16.851,9.728L12.164,64,37.021,74.958,20.165,84.689,5.573,82.2,4.227,90.084,15.49,92.007l-3.967,10.716,7.5,2.777,5.139-13.883,16.856-9.732-2.937,27.008L60,92.849v16.9l-9.453,11.392,6.156,5.108,7.3-8.793,7.3,8.793,6.156-5.108L68,109.747v-16.9l21.926,16.051-2.936-27,16.844,9.725,5.14,13.883,7.5-2.777L112.51,92.007l11.262-1.923ZM96.018,64,82.4,70,72,64l10.4-6.006ZM80.012,36.273,78.4,51.066,68,57.072V45.066ZM48,36.274l12,8.785V57.072l-10.392-6ZM31.993,64,45.6,58,56,64,45.607,70ZM48,91.72l1.609-14.792,10.393-6V82.935Zm32.014,0L68,82.928v-12l10.4,6.007Z" 
        fill="url(#linear-gradient)"
        id="svg_1"
      />
    </g>
  </g>
</svg>
`;
const ICON_PIG = `<svg
  width="30"
  height="30"
  viewBox="0 0 500 350"
  xmlns="http://www.w3.org/2000/svg"
  xmlns:svg="http://www.w3.org/2000/svg"
>
  <defs>
    <linearGradient
      id="linear-gradient"
      x1="0.19582"
      x2="0.90472"
      y1="0.93246"
      y2="-0.08025"
    >
      <stop offset="0" stop-color="#41dfd0" />
      <stop offset="1" stop-color="#ee83ef" />
    </linearGradient>
  </defs>
  <g class="layer">
    <g id="gradient">
      <path
        d="m85,115a12,12 0 1 1 -12,12a12,12 0 0 1 12,-12zm376.4,-50.5a69.74,69.74 0 0 1 19.6,48.5l0,14.487a104.067,104.067 0 0 1 -25.037,67.682l-22.963,26.79l0,45.041a7.994,7.994 0 0 1 -0.845,3.578l-32,64a8,8 0 0 1 -7.155,4.422l-32,0a8,8 0 0 1 -7.919,-9.131l7.778,-54.449l-5.472,-21.889a212.947,212.947 0 0 1 -159.609,-8.275l-10.778,16.166l0,21.578a7.994,7.994 0 0 1 -0.845,3.578l-7.607,15.214l-7.787,31.148a8,8 0 0 1 -7.761,6.06l-40,0a8,8 0 0 1 -7.761,-9.94l7.6,-30.386l-7.305,-43.83l-20.492,-20.492a212.954,212.954 0 0 1 -74.383,-31.3l-14.093,-9.395a8,8 0 0 1 -3.566,-6.657l0,-48a8,8 0 0 1 4.422,-7.155l13.422,-6.711a119.816,119.816 0 0 0 31.187,-22.478l0.35,-0.35a120.309,120.309 0 0 0 14.994,-18.289l0.033,-0.05l-27.56,-21.931a8,8 0 0 1 1.02,-13.21l6.521,-3.718a91.807,91.807 0 0 1 79.729,-5.6l9.094,3.609c1.505,-0.077 276.788,-0.117 276.788,-0.117a69.542,69.542 0 0 1 32.44,8l5.56,0a16,16 0 0 0 0,-32l-24,0a8,8 0 0 1 0,-16l24,0a32,32 0 0 1 12.4,61.5zm-356.4,46.376a36.041,36.041 0 0 1 -14.565,-6.993l-12.468,-9.922a136.35,136.35 0 0 1 -16.273,19.658l-0.35,0.35a135.723,135.723 0 0 1 -35.344,25.476l-9,4.5l0,38.775l10.53,7.02a197.043,197.043 0 0 0 71,29.408c1.549,0.311 6.471,4.54 6.471,4.54l-0.001,-112.812zm64,164.124l-35.89,0l3.781,22.685a7.991,7.991 0 0 1 -0.13,3.255l-5.515,22.06l23.508,0l6.485,-25.94a7.921,7.921 0 0 1 0.606,-1.638l7.155,-14.311l0,-6.111zm16,-128l-64,0l0,92.687l5.657,5.656a8,8 0 0 1 2.234,4.342l1.553,9.315l38.556,0c0,-1.58 16,-26.422 16,-26.422l0,-85.578zm0,-88s-55.225,-0.426 -55.812,-0.659l-9.974,-3.96a75.843,75.843 0 0 0 -62.054,2.575l43.24,34.408a19.9,19.9 0 0 0 22.359,1.725l18.281,-10.422a8,8 0 0 1 7.924,13.9l-18.281,10.422a36.238,36.238 0 0 1 -9.681,3.8l0,20.211l64,0l-0.002,-72zm16,112l120,0l0,-112l-120,0l0,112zm0.316,54.8a337.864,337.864 0 0 0 100.311,-38.8l-100.627,0l0,38.87l0.316,-0.07zm144.226,14.131a88.707,88.707 0 0 1 -23.373,-46.785a353.316,353.316 0 0 1 -102.34,44.7a197.063,197.063 0 0 0 125.713,2.087l0,-0.002zm54.514,59.069l-26.4,0l-3.429,24l17.832,0l11.997,-24zm16.944,-71.953a73.338,73.338 0 0 0 -47.1,18.571l6.86,27.442c0.251,1 -0.823,9.94 -0.823,9.94l32.118,0l8.945,-17.889l0,-38.064zm21.678,-160.392a7.987,7.987 0 0 1 -2.919,-1.62a53.646,53.646 0 0 0 -24.759,-6.035l-74,0l0,120a72.4,72.4 0 0 0 23.7,53.393a89.272,89.272 0 0 1 58.241,-21.393l2.379,0l22.494,-26.243a88.057,88.057 0 0 0 21.186,-57.27l0,-14.487a54.016,54.016 0 0 0 -26.322,-46.345z"
        fill="url(#linear-gradient)"
        id="svg_1"
      />
    </g>
  </g>
</svg>
`;

function formatAmount({ amount = 1 } = {}) {
  if (amount === 1) {
    return 'porcja';
  }
  if (amount < 5) {
    return 'porcje';
  }
  return 'porcji';
}

function create$ItemContent(item) {
  return `
    <div class="header">
        <h1>${item.name}${item.size ? ` (${item.size}g)` : ''}</h1>
        <p>${item.amount} ${formatAmount(item)}</p>
    </div>
    <div class="details">
        <p>${ICON_PIG} ${(item.meatTypeName || [])[0]}</p>
        <p>${ICON_SNOWFLAKE} ${item.date}</p>
    </div>
    <button type="button" data-item-id="${
      item.id
    }">Wyjmij jedną porcję</button>`;
}

function to$Item(item) {
  return `<li id="${item.id}">
        ${create$ItemContent(item)}
      </li>`;
}

async function freezerItems($container) {
  try {
    const freezerItems = await (await fetch('/api/freezer')).json();
    const formattedItems = freezerItems.items.map(to$Item);
    $container.innerHTML = formattedItems.join('');
  } catch (err) {
    alert('Nie udało się pobrać szyflady: ' + err.message);
  }
}

async function onRemoveFreezerItemClicked(event) {
  event.target.disabled = true;
  const itemId = event.target.dataset.itemId;
  if (!itemId) {
    return;
  }
  try {
    const updatedItem = await (
      await fetch('/api/freezer', {
        method: 'PATCH',
        body: JSON.stringify({ id: itemId }),
      })
    ).json();
    const $item = document.querySelector(`#${itemId}`);
    if (updatedItem.amount <= 0) {
      $item.parentNode.removeChild($item);
      return;
    }
    $item.innerHTML = create$ItemContent(updatedItem);
  } catch (err) {
    alert('Nie udało się wyjąć z szyflady: ' + err.message);
  } finally {
    event.target.disabled = true;
  }
}

async function runApp() {
  const $freezerList = document.querySelector('#freezer');
  $freezerList.addEventListener('click', onRemoveFreezerItemClicked);
  await freezerItems($freezerList);
  //   const $navigationBar = document.querySelector('#navigation');
  //   $navigationBar.addEventListener('click', onNavigationButtonClicked);
}

document.addEventListener('DOMContentLoaded', runApp);

// function onModalActionClicked($modal, $buttonsContainer) {
//   return async function onModalActionClicked(event) {
//     $buttonsContainer.removeEventListener('click', this);
//     if (event.target.id === 'close-btn') {
//       $modal.classList.remove('open');
//       return;
//     }
//     if (event.target.id === 'add-btn') {
//       $buttonsContainer
//         .querySelectorAll('button')
//         .forEach((button) => (button.disabled = true));
//       const name = document.querySelector('input#name').value;
//       const amount = parseInt(document.querySelector('input#amount').value, 10);
//       const size = parseInt(document.querySelector('input#size').value, 10);
//       const type = document.querySelector('select#type').value;
//       const date = new Date().toISOString().slice(0, 10);
//       const createdItem = await (
//         await fetch('/api/freezer', {
//           method: 'POST',
//           body: JSON.stringify({ name, amount, size, type, date }),
//         })
//       ).json();
//       const $freezerList = document.querySelector('#freezer');
//       const $newItem = document.createElement('li');
//       $newItem.id = createdItem.id;
//       $newItem.innerHTML = create$ItemContent(createdItem);
//       $freezerList.append($newItem);
//       $modal.classList.remove('open');
//     }
//   };
// }

// async function onNavigationButtonClicked(event) {
//   if (event.target.id === 'add-to-freezer-btn') {
//     const meatTypes = await (await fetch('/api/meat-types')).json();
//     const $meatTypeSelect = document.querySelector('select#type');
//     $meatTypeSelect.options.length = 0;
//     const genericOption = new Option('Wybierz', '', true, true);
//     genericOption.disabled = true;
//     $meatTypeSelect.options.add(genericOption);
//     meatTypes.forEach((meatType) => {
//       $meatTypeSelect.options.add(
//         new Option(meatType.name, meatType.id, false)
//       );
//     });
//     const $addToFreezerModal = document.querySelector('#add-to-freezer-modal');
//     const $addToFreezerModalActions = document.querySelector(
//       '#add-to-freezer-modal-actions'
//     );
//     $addToFreezerModalActions
//       .querySelectorAll('button')
//       .forEach((button) => (button.disabled = false));
//     $addToFreezerModalActions.addEventListener(
//       'click',
//       onModalActionClicked($addToFreezerModal, $addToFreezerModalActions)
//     );
//     $addToFreezerModal.classList.add('open');
//   }
// }
